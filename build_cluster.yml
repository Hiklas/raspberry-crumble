---
- name: Common setup
    hosts: allnodes
    gather_facts: True
    user: root

    tasks:
      - name: Update apt cache
        apt:
          update_cache: yes

      - name: Install NFS packages
        apt-get:
          state: present
          name: {{ item }}
        with_items:
          - nfs-kernel-server
          - nfs-common
          - portmap
          - autofs

      - name: Install MPI packages
        apt-get:
          state: present
          name: {{ item }}
        with_items:
          - python-mpi4py
          - python-mpi4py-doc

      - name: Make the /data directory
        file:
          path: /data
          mode: 0777
          state: directory

      - name: Make the /net directory
        file:
          path: /net
          mode: 0777
          state: directory

      - name: Make the /etc/auto.master.d directory
        file:
          path: /etc/auto.master.d
          mode: 0744
          state: directory


- name: Master node setup
    hosts: master




- name: FPGA node setup
    hosts: fpga


